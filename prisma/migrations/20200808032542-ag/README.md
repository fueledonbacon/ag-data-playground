# Migration `20200808032542-ag`

This migration has been generated by Ryan Cwynar at 8/7/2020, 11:25:42 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `agriculture`.`Grower` (
`id` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL ,
`auth` varchar(191) NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `agriculture`.`Farm` (
`id` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL ,
`growerId` int NOT NULL ,
`meta` json NOT NULL ,
`locationId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `agriculture`.`Field` (
`id` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL ,
`lat` decimal(65,30) NOT NULL ,
`long` decimal(65,30) NOT NULL ,
`soil_type` varchar(191) NOT NULL ,
`water_holding_capacity` decimal(65,30) NOT NULL ,
`meta` json NOT NULL ,
`farmId` int NOT NULL ,
`locationId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `agriculture`.`Planting` (
`id` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL ,
`planted_at` datetime(3) NOT NULL ,
`fieldId` int NOT NULL ,
`meta` json NOT NULL ,
`farmId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `agriculture`.`Location` (
`id` int NOT NULL  AUTO_INCREMENT,
`lat` decimal(65,30) NOT NULL ,
`long` decimal(65,30) NOT NULL ,
`name` varchar(191)  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `agriculture`.`Measurement` (
`id` int NOT NULL  AUTO_INCREMENT,
`type` varchar(191) NOT NULL ,
`source` varchar(191) NOT NULL ,
`date` datetime(3) NOT NULL ,
`value` decimal(65,30) NOT NULL ,
`unit` varchar(191) NOT NULL ,
`lat` decimal(65,30) NOT NULL ,
`long` decimal(65,30) NOT NULL ,
`plantingId` int  ,
`locationId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `Grower.auth_unique` ON `agriculture`.`Grower`(`auth`)

ALTER TABLE `agriculture`.`Farm` ADD FOREIGN KEY (`locationId`) REFERENCES `agriculture`.`Location`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `agriculture`.`Farm` ADD FOREIGN KEY (`growerId`) REFERENCES `agriculture`.`Grower`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `agriculture`.`Field` ADD FOREIGN KEY (`locationId`) REFERENCES `agriculture`.`Location`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `agriculture`.`Field` ADD FOREIGN KEY (`farmId`) REFERENCES `agriculture`.`Farm`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `agriculture`.`Planting` ADD FOREIGN KEY (`fieldId`) REFERENCES `agriculture`.`Field`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `agriculture`.`Planting` ADD FOREIGN KEY (`farmId`) REFERENCES `agriculture`.`Farm`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `agriculture`.`Measurement` ADD FOREIGN KEY (`locationId`) REFERENCES `agriculture`.`Location`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `agriculture`.`Measurement` ADD FOREIGN KEY (`plantingId`) REFERENCES `agriculture`.`Planting`(`id`) ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200808032542-ag
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,80 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Grower {
+  id    Int    @id @default(autoincrement())
+  farms Farm[]
+  name  String
+  auth  String @unique
+}
+
+model Farm {
+  id         Int        @id @default(autoincrement())
+  fields     Field[]
+  name       String
+  location   Location?  @relation(fields: [locationId], references: [id])
+  grower     Grower     @relation(fields: [growerId], references: [id])
+  growerId   Int
+  meta       Json
+  Planting   Planting[]
+  locationId Int?
+}
+
+model Field {
+  id                     Int        @id @default(autoincrement())
+  plantings              Planting[]
+  name                   String
+  location               Location?  @relation(fields: [locationId], references: [id])
+  lat                    Float
+  long                   Float
+  soil_type              String
+  water_holding_capacity Float
+  meta                   Json
+  farm                   Farm       @relation(fields: [farmId], references: [id])
+  farmId                 Int
+  locationId             Int?
+}
+
+model Planting {
+  id           Int           @id @default(autoincrement())
+  name         String
+  planted_at   DateTime
+  measurements Measurement[]
+  field        Field          @relation(fields: [fieldId], references: [id])
+  fieldId      Int
+  meta         Json
+}
+
+model Location {
+  id          Int           @id @default(autoincrement())
+  lat         Float
+  long        Float
+  name        String?
+  Farm        Farm[]
+  Field       Field[]
+  Measurement Measurement[]
+}
+
+model Measurement {
+  id         Int       @id @default(autoincrement())
+  type       String
+  source     String
+  date       DateTime
+  value      Float
+  unit       String
+  location   Location? @relation(fields: [locationId], references: [id])
+  lat        Float
+  long       Float
+  Planting   Planting? @relation(fields: [plantingId], references: [id])
+  plantingId Int?
+  locationId Int?
+}
```


